# 1.3.1. Configuration Classes

## Overview

Summary of all configuration classes mentioned in plans 1.3, 1.4, and 1.5. This document catalogs existing configuration classes and identifies new ones that need to be created, along with suggested library locations.

## Status

⏳ **TODO** - Planning document for configuration class implementation.

## Related Plans

- **1.3** - Multiple Client Configuration
- **1.4** - Client Configuration Setup
- **1.5** - Model List Management

## Configuration Classes Summary

### 1. Connection Configuration

**Purpose**: Represents a single server connection configuration (name, URL, API key, default flag).

**Properties**:
- `name` (string) - Connection alias/name (e.g., "Local Ollama", "OpenAI", "Remote Server")
- `url` (string) - Server URL (e.g., `http://127.0.0.1:11434/api`)
- `api_key` (string) - Optional API key for authentication (plain text storage)
- `default` (bool) - Whether this is the default connection

**Status**: ⏳ **NEW** - Not yet implemented

**Suggested Location**: `libollmchat/Settings/Connection.vala`

**References**:
- Plan 1.3: Connection Settings section
- Plan 1.3: Files to Create section

---

### 2. Model Options (Per-Model Overrides)

**Purpose**: Per-model option overrides stored as a map in Config2.

**Structure**:
- Map of model name → `Call.Options` overrides
- Stored directly in Config2 as `model_options` map (Gee.Map<string, Call.Options>)

**Status**: ⏳ **NEW** - Not yet implemented (uses existing `Call.Options` class)

**Note**: This is just a map in Config2, not a separate class. Uses existing `Call.Options` class (`libollmchat/Call/Options.vala`) for the actual option values. A separate `Settings/ModelOptions` class is only needed if we want a wrapper/helper class, otherwise just use the map directly.

**References**:
- Plan 1.3: Configuration Storage Format section (model_options object)
- Plan 1.5: Default Model Options section
- Plan 1.5: Model Configuration Storage section

---

### 3. Chat Defaults

**Purpose**: Chat-specific settings separate from Client class (not to be confused with Options class).

**Properties**:
- `model` (string) - Model name to use
- `stream` (bool) - Whether to stream responses
- `format` (string) - Response format (json, schema, etc.)
- `think` (bool) - Whether to return thinking output
- `keep_alive` (string/int) - Model keep-alive duration

**Status**: ⏳ **NEW** - Not yet implemented (low priority per plan 1.4)

**Suggested Location**: `libollmchat/Settings/ChatDefaults.vala`

**Note**: Runtime options (seed, temperature, top_p, etc.) remain in `Call.Options` class - do not overlap.

**References**:
- Plan 1.4: Phase 6: Chat Defaults section
- Plan 1.4: Files to Create section

---

### 4. Config (Existing - Version 1)

**Purpose**: Current single-client configuration management.

**Properties**:
- `url` (string) - Server URL ✅
- `api_key` (string) - Optional API key ✅
- `model` (string) - Model name ✅
- `title_model` (string) - Title generation model ✅
- `think` (bool) - Whether to return thinking output ✅

**Status**: ✅ **EXISTS** - Implemented

**Location**: `libollmchat/Config.vala`

**References**:
- Plan 1.4: Phase 2: Basic Configuration Persistence section
- Plan 1.4: Files Created section

---

### 5. Call.Options (Existing)

**Purpose**: Runtime options for Ollama API calls (temperature, top_p, top_k, num_ctx, etc.).

**Properties**:
- `seed` (int) - Random seed ✅
- `temperature` (double) - Temperature setting ✅
- `top_p` (double) - Top-p sampling ✅
- `top_k` (int) - Top-k sampling ✅
- `num_predict` (int) - Maximum tokens to predict ✅
- `repeat_penalty` (double) - Repeat penalty ✅
- `min_p` (double) - Minimum probability ✅
- `num_ctx` (int) - Context window size ✅
- `stop` (string) - Stop sequences ✅

**Status**: ✅ **EXISTS** - Implemented

**Location**: `libollmchat/Call/Options.vala`

**References**:
- Plan 1.3: System Models Management UI section (uses Call.Options)
- Plan 1.5: Default Model Options section (uses Call.Options)
- Used directly in Config2's model_options map

---

### 6. Config1 (Version Reader/Migrator)

**Purpose**: Helper class for reading version 1 format and migrating to Config2 (for migration from existing config.json).

**Status**: ⏳ **NEW** - Not yet implemented

**Suggested Location**: `libollmchat/Config1.vala`

**Note**: This is a utility class for migration, not a serializable holder. It reads old Config format and converts to Config2.

**References**:
- Plan 1.4: Phase 3: Configuration Version Management section
- Plan 1.4: Files to Create section

---

### 7. Config2 (Main Configuration Holder)

**Purpose**: Main serializable configuration holder for version 2 format (multiple clients, extended structure). This is the top-level container class that holds all configuration data.

**Properties**:
- `connections` (Gee.Map<string, Settings.Connection>) - Map of connection URL → Connection objects
- `model_options` (Gee.Map<string, Call.Options>) - Map of model name → Call.Options (per-model option overrides)

**Status**: ⏳ **NEW** - Not yet implemented

**Suggested Location**: `libollmchat/Config2.vala`

**Note**: This is the main serializable holder class, not just a reader. It implements `Json.Serializable` and contains all configuration data. Model options are stored as a simple map of model name to options - connection is not important here.

**References**:
- Plan 1.3: Configuration Storage Format section (config.2.json)
- Plan 1.3: Files to Create section
- Plan 1.4: Phase 3: Configuration Version Management section

---

## Configuration Storage Structure

### Version 1 (Current - config.json)
```json
{
  "url": "http://localhost:11434/api",
  "api_key": "",
  "model": "",
  "title_model": "",
  "think": true
}
```

### Version 2 (Future - config.2.json)
```json
{
  "connections": {
    "http://127.0.0.1:11434/api": {
      "name": "Local Ollama",
      "url": "http://127.0.0.1:11434/api",
      "api_key": "",
      "default": true
    }
  },
  "model_options": {
    "default": {
      "temperature": 0.7,
      "top_p": 0.9,
      "top_k": 40,
      "num_ctx": 2048
    },
    "llama3": {
      "temperature": 0.5,
      "num_ctx": 4096
    }
  }
}
```

## Library Organization

### libollmchat/
Core configuration classes for the OLLMchat library.

**Existing**:
- `Config.vala` - Version 1 config (single client)
- `Call/Options.vala` - Runtime API options

**To Create**:
- `Settings/Connection.vala` - Connection configuration
- `Settings/ChatDefaults.vala` - Chat-specific settings (low priority)
- `Settings/ModelOptions.vala` - Model options defaults and overrides (if needed as separate class, otherwise just use map in Config2)
- `Config2.vala` - Main serializable configuration holder (version 2)
- `Config1.vala` - Version 1 migration helper

### Rationale

- **Settings/** subdirectory: All ollmchat configuration classes go here (Connection, ChatDefaults, ModelOptions if needed)
- **Config2.vala**: Main serializable holder at root level - contains connections map and model_options map (model name → Call.Options)
- **Config1.vala**: Migration helper at root level for converting old Config to Config2
- **Call/Options.vala**: Remains in Call/ as it's part of the API call infrastructure (not a settings class), used directly in Config2's model_options map

## Implementation Priority

1. **High Priority**:
   - `Settings/Connection.vala` - Required for multiple client support (1.3)
   - `Config2.vala` - Main serializable holder for version 2 config format (1.3) - contains connections map and model_options map (model name → Call.Options)
   - `Settings/ModelOptions.vala` - Only if needed as separate class, otherwise model_options is just a map in Config2 (1.3, 1.5)

2. **Medium Priority**:
   - `Config1.vala` - Required for migration from version 1 (1.4)

3. **Low Priority**:
   - `ChatDefaults.vala` - Nice to have, not critical (1.4 Phase 6) - chat options, not settings

## Dependencies

- All Settings classes should implement `Json.Serializable` for persistence
- `Config2` is the main serializable holder that contains:
  - `connections` map: `Gee.Map<string, Settings.Connection>`
  - `model_options` map: `Gee.Map<string, Call.Options>` (model name → options)
- `Config2` uses `Settings/Connection` for connections and `Call.Options` directly for model options
- `Settings/ModelOptions` class only needed if we want a wrapper/helper class, otherwise just use the map directly in Config2
- Migration path: `Config1` reads old `Config.vala` format and creates new `Config2` instance

## Notes

- `Call.Options` is already implemented and should be reused for model options
- All Settings classes should follow the same pattern as existing `Config.vala` (Json.Serializable, clone method, etc.)
- `Config2` is the main serializable holder class - it contains:
  - Connections map (connection URL → Settings.Connection)
  - Model options map (model name → Call.Options) - connection is not important here
- No separate ModelConfig class needed - just use a map of model name to Call.Options in Config2
- `Config1` is a migration helper utility, not a serializable holder
- All ollmchat configuration classes go in `Settings/` subdirectory (except ChatDefaults which is chat options, not settings)

