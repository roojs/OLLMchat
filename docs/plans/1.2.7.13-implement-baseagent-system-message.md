# 1.2.7.13. Implement BaseAgent.system_message() Method

## Overview

Currently `CodeAssistantHandler.send_async()` uses `agent.fill(this.chat, "")` to get system prompt. This is a workaround - should use dedicated `system_message()` method.

**Parent Plan**: [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md)

## Status

‚è≥ **TODO** - Cleanup phase after signal migration.

## Goal

Implement proper `system_message()` method for agents to generate system prompts with context.

## Issue

Currently `CodeAssistantHandler.send_async()` uses `agent.fill(this.chat, "")` to get system prompt. This is a workaround - should use dedicated `system_message()` method.

## Current State

- `BaseAgent.system_message(AgentHandler handler)` exists as placeholder that returns empty string
- `CodeAssistantHandler.send_async()` calls `this.agent.system_message(this)` which currently returns empty string
- CodeAssistant needs to override this to generate system prompt with current context

## Proposed Implementation

- `BaseAgent.system_message()` - Default returns empty string (for simple agents like JustAsk)
- `CodeAssistant.system_message()` - Override to generate system prompt with current context (open files, workspace, etc.)
- Method receives `AgentHandler` so it can access `handler.session`, `handler.client`, etc.

## Action

Implement `CodeAssistant.system_message()` override during 1.2.7 cleanup to properly generate system prompt with current context.

## Files to Modify

- `libollmchat/Prompt/BaseAgent.vala` - Ensure `system_message()` method exists
- `liboccoder/Prompt/CodeAssistant.vala` - Override `system_message()` to generate system prompt

## Testing Checklist

- [ ] `BaseAgent.system_message()` method works correctly
- [ ] `CodeAssistant.system_message()` generates system prompt with context
- [ ] All functionality still works correctly after cleanup

## Related Plans

- [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md) - Parent plan
- [1.2.7.8. Cleanup Items](./1.2.7.8-cleanup-items.md) - Related cleanup item

