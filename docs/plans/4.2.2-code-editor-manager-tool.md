# 4.2.2. Code Editor Manager Tool

## Overview

Create a tool that allows the LLM to manage the code editor interface - opening files, switching files, and navigating to specific line numbers.

## Status

⏳ **TODO** - Not yet implemented.

## Features

- **Open/Switch to file**: Open a file in the SourceView code editor, or switch to an already open file
- **Navigate to line**: Jump to a specific line number in the current or target file
- **EditMode Integration**: Intercept EditMode changes and update SourceView editor UI

## Implementation Plan

### Component: Code Editor Manager Tool
- **Namespace**: `OLLMchat.Tools`
- **Class**: `OLLMchat.Tools.CodeEditorManager` (implements `OLLMchat.Tool.Interface`)
- **Request Handler**: `OLLMchat.Tools.RequestCodeEditorManager` (extends `OLLMchat.Tool.RequestBase`)
- **Purpose**: Allow LLM to control file navigation and cursor positioning in the code editor UI

### Tool Capabilities
Single unified tool that handles:
- **Open/Switch to file**: Open a file in the SourceView code editor, or switch to an already open file/tab
- **Navigate to line**: Jump to a specific line number in the current or target file
- Parameters: `file_path` (required), `line_number` (optional)

**Note**: Query operations (get cursor position, get selected text, get file contents) are already provided by `CodeAssistantProvider` (Phase 5) and do not need to be duplicated in this tool.

### Implementation Details
- Tool follows the same pattern as `ReadFile`, `EditMode`, `RunCommand`
- Single tool handles both file opening/switching and line navigation
- If file is not open, opens it; if already open, switches to it
- If line_number is provided, navigates to that line after opening/switching
- Integrates with SourceView component from Phase 3
- May need to integrate with WindowPane to ensure code view is visible
- Request handler will need access to SourceView instance
- GTK-specific implementation in `libollmchatgtk/Tools/RequestCodeEditorManager.vala`

### EditMode Integration
- **Component**: `OLLMchat.Tools.EditModeWrapper`
- **Purpose**: Intercept EditMode changes and update SourceView editor UI
- **Implementation**: 
  - Wraps the existing `EditMode` tool
  - Connects to `EditMode.change_done` signal to intercept file changes
  - Updates SourceView when files are edited via EditMode tool
  - If file is open in editor, refreshes content and highlights changes
  - If file is not open, optionally opens it in editor to show changes

### Files to Create
- `liboctools/CodeEditorManager.vala` - Tool interface definition (namespace: `OLLMtools`)
- `liboctools/RequestCodeEditorManager.vala` - Base request handler (namespace: `OLLMtools`)
- `libollmchatgtk/Tools/RequestCodeEditorManager.vala` - GTK-specific implementation with SourceView integration (SourceView is in liboccoder, accessed via manager)
- `libollmchatgtk/Tools/EditModeWrapper.vala` - Wrapper to intercept EditMode changes and update SourceView

### Files to Modify
- `ollmchat/Window.vala` - Add CodeEditorManager tool to client, use EditModeWrapper instead of direct EditMode
- `liboccoder/SourceView.vala` - Expose methods for tool to control editor (open file, navigate, refresh content, highlight changes)
- `ollmchat/WindowPane.vala` - May need to expose method to show/ensure code view is visible

## Tool Interface

### CodeEditorManager Tool
```vala
public interface CodeEditorManager : Tool.Interface {
  // Tool name and description
  public string name { get; }
  public string description { get; }
  
  // Tool parameters
  public struct Parameters {
    public string file_path;      // Required: Path to file to open/switch to
    public int? line_number;      // Optional: Line number to navigate to
  }
}
```

### Request Handler
- Handles tool requests from LLM
- Validates file path
- Calls SourceView methods to open/navigate
- Returns success/error status

## Integration Points

### SourceView Methods Needed
- `open_file(File file, int? line_number = null)` - Already exists, may need to expose for tool access
- `navigate_to_line(int line_number)` - Already exists, may need to expose for tool access
- `refresh_file()` - May need enhancement to handle EditMode changes
- `highlight_changes()` - New method to highlight changes from EditMode

### WindowPane Integration
- May need method to ensure code view is visible when tool opens a file
- `show_right_pane()` - Already exists, may need to call from tool

### EditMode Wrapper
- Intercepts `EditMode.change_done` signal
- Gets list of changed files
- For each changed file:
  - If file is open in SourceView: Refresh content and highlight changes
  - If file is not open: Optionally open it to show changes

## Related Plans

- Part of 4.2 Code Editor Interface (now 4.2-DONE)
- Depends on Phase 3: Source View Component (✅ DONE)
- Depends on Phase 5: CodeAssistant Integration (✅ DONE)
- Integrates with EditMode tool (existing)
