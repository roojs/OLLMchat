# Table support Phase 4: Table handling code (1.10.4)

Part of the phased implementation for markdown table support; see **1.8.2-table-support-current-design.md** for the overall design and phase order. Depends on **1.10.1**, **1.10.2**, **1.10.3** (renderer interface and implementations).

---

## Goal

Implement **handle_table_line(line)** in Parser so that every table row is processed one line at a time (split initial 3-line block into 3 lines and call handle_table_line(line) three times; when in TABLE, pass each subsequent line to handle_table_line(line) once). Inside: buffer line 1 (header) and line 2 (separator); on line 3 emit on_table(start), then header row, alignment, this row; for each line (1–3 and 4+): tr start → cells (format.eat()) → tr end. Handle table end when a non-table line is seen.

## File

`libocmarkdown/Parser.vala`

## Code to add

- New method **handle_table_line(string line)** (or `handle_table_line(chunk, start_byte, length)` if you prefer).
- Internal state: table row index (or phase: header, separator, body), column count, optional alignments.
- Parse the line into cells (split on `|`, trim).
- For each cell: run the cell text through formatmap.eat() and the same format handlers as paragraph text (got_format, do_format, handle_format_result), emitting on_table_hcell / on_table_cell around the content.
- Emit on_table_row(true) at line start and on_table_row(false) at line end.
- **Line 1:** buffer it.
- **Line 2:** parse alignment, buffer it.
- **Line 3:** emit on_table(true), then emit header row from buffered line 1, then alignment row from buffered line 2, then this row (line 3).
- **Lines 4+:** emit tr → cells (format.eat()) → tr end.
- Any types (e.g. alignment enum) can be defined in Parser.vala or a small Types file.
