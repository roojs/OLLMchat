# 1.2.6.6. Update Search

## Overview

Update Search to take `Connection` and `model` instead of `Client`.

**Parent Plan**: [1.2.6. Update Legacy Methods](./1.2.6-update-legacy-methods.md)

**Prerequisite**: [1.2.6.1. Update Client Method Signatures](./1.2.6.1-update-client-method-signatures.md) must be complete

## Status

‚è≥ **TODO** - Needs implementation.

## Goal

Search should not depend on `Client` with config. According to plan 1.2, Manager owns the config, not Client.

## Current Implementation

**File**: `libocvector/Search/Search.vala` (line 187)

```vala
public Search(
    OLLMvector.Database vector_db,
    SQ.Database sql_db,
    OLLMchat.Client embedding_client,
    OLLMfiles.Folder folder,
    string query,
    // ...
)
{
    this.embedding_client = embedding_client;
    // ...
}
// ...
var embed_response = yield this.embedding_client.embed(normalized_query);
```

**Problem**: Search takes `Client` but should take `Connection` and model.

## Proposed Fix

```vala
private Settings.Connection connection;
private string model;

public Search(
    OLLMvector.Database vector_db,
    SQ.Database sql_db,
    Settings.Connection connection,
    string model,
    OLLMfiles.Folder folder,
    string query,
    // ...
)
{
    this.vector_db = vector_db;
    this.sql_db = sql_db;
    this.connection = connection;
    this.model = model;
    this.folder = folder;
    this.query = query;
    // ...
}

public async Gee.ArrayList<SearchResult> execute() throws GLib.Error
{
    // ... normalize query ...
    
    // Step 2: Query vectorization (convert text to embeddings)
    GLib.debug("Vectorizing query: %s", normalized_query);
    var client = new Client(this.connection);
    var embed_response = yield client.embed(this.model, normalized_query);
    if (embed_response == null || embed_response.embeddings.size == 0) {
        throw new GLib.IOError.FAILED("Failed to get query embedding");
    }
    
    // ... rest of implementation ...
}
```

## Implementation Steps

1. Update `Search` constructor to take `Connection` and `model`
2. Update `execute()` method to create Client from Connection
3. Find all call sites of Search constructor and update them
4. Test that search operations still work

## Test

Verify search operations still work for codebase search.

## Result

Search uses model parameter explicitly and no longer depends on Client with config.

## Files to Modify

- `libocvector/Search/Search.vala` - Update constructor and `execute()` method
- Find and update all Search constructor call sites

## Related Plans

- [1.2.6.1. Update Client Method Signatures](./1.2.6.1-update-client-method-signatures.md) - Prerequisite

