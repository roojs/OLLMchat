# 2.8. Web Search Tool

## Overview

Implementation of WebSearchTool for performing web searches using Google or DuckDuckGo API.

## Status

‚è≥ **TODO** - To be implemented.

## Implementation Details

### Features
- Use Google or DuckDuckGo API for web searches
- Return markdown version of search results (using HTML2Markdown)
- API integration (Google Custom Search API or DuckDuckGo API)
- **Google Custom Search API**
  - Endpoint: `https://www.googleapis.com/customsearch/v1?key=YOUR_API_KEY&cx=YOUR_SEARCH_ENGINE_ID&q=QUERY&start=INDEX`
  - Returns JSON containing:
    - `totalResults` (total number of results)
```vala
using GLib;
using Gee;

public class ResultItem {
    public string title;
    public string snippet;
    public string link;

    public ResultItem (string title, string snippet, string link) {
        this.title = title;
        this.snippet = snippet;
        this.link = link;
    }

    public string to_markdown () {
        // Returns markdown for a single result item
        return "### [" + title + "](" + link + ")\n" + snippet + "\n";
    }
}

public class Result {
    public int total_results;
    public ArrayList<ResultItem> items;

    public Result (int total_results, ArrayList<ResultItem> items) {
        this.total_results = total_results;
        this.items = items;
    }

    public string to_markdown () {
        var sb = new StringBuilder ();
        sb.append_printf ("**Total results:** %d\n\n", total_results);
        foreach (var item in items) {
            sb.append (item.to_markdown ());
        }
        return sb.str;
    }
}

            return header + body
    ```

- Convert HTML search results to markdown format
- Result filtering/ranking
- Rate limiting: Max 10 searches per 15-minute sliding window
- Timestamp tracking: Maintain `ArrayList<DateTime>` of search timestamps per chat session
- Pruning logic: Remove timestamps older than 15 minutes before each search
- Permission request: When limit reached, ask user permission and clear list if granted
- Chat ID tracking (may need to add chat_id to ChatCall or use ChatWidget's current_chat)
- Permission question building (include search query in question)

### Files
- `liboctools/WebSearchTool.vala` (to be created, namespace: `OLLMtools`)

### Testing
- Test with PermissionProviderDummy
- Add to meson.build
