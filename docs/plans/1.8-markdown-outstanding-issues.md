# 1.8 Markdown outstanding issues

- **Goal:** Track and address remaining markdown rendering/parsing gaps after the 1.8.x / 1.10.x work: table width adjustments, reference-style links, images, footnotes, and definition lists.
- **Status:** open.

---

## Scope

Five areas:

1. **Table width adjustments** — Table column sizing and layout behaviour.
2. **Reference links** — Resolving reference-style link definitions so `[text][ref]` uses the correct URL.
3. **Images** — Parsing and rendering `![alt](url)` and optional `![alt](url "title")`.
4. **Footnotes** — Parsing and rendering footnote syntax (e.g. `^[ref]` or `[^ref]` and footnote definitions).
5. **Definition lists** — Parsing and rendering term/definition list syntax (e.g. `term` followed by `: definition`).

---

## 1. Table width adjustments

- **Context:** Plan 1.10.7 (table column auto-size) defines content-based column width sizing in **libocmarkdowngtk/Table.vala** (cells, cellwidths, `build_widths_and_resize()`, min/max rules).
- **Outstanding:**
  - Verify/finalise min/max column width rules and container-width behaviour.
  - Any UX improvements: proportional vs fixed column widths, user resizing, or responsive behaviour when the container is resized.
  - Edge cases: very long cell content, many columns, narrow windows.
- **References:** 1.10.7-DONE-table-column-autosize.md, 1.10.4-DONE-table-handling.md, 1.8.2-DONE-table-support-current-design.md.

---

## 2. Reference links

- **Context:** Parser (1.10.9) emits reference-style links as `on_a(true, href, title, is_reference)` with **href** = reference label (not URL). Renderer (1.10.10) stores href on the tag and does **not** resolve references; click/hover use whatever href is given.
- **Outstanding:**
  - **Link reference definitions:** Parse and store definitions `[ref]: url "title"` (and variants) so the consumer has a map of ref label → (url, title).
  - **Resolution at render/click time:** When **is_reference** is true, resolve **href** (ref label) to the actual URL (and optional title) using that definition map before opening the link or showing tooltip.
  - **Where resolution lives:** Either in the parser (collect definitions in a first pass or as we go), or in the renderer/app (parser passes definitions; renderer resolves when handling click/hover). Decision needed.
- **References:** 1.10.9-DONE-parser-links.md, 1.10.10-DONE-rendering-links.md.

---

## 3. Images

- **Context:** **RenderBase** (and HtmlRender, PangoRender, DummyRenderer) define `on_img(string src, string? title)`. FormatMap (1.10.9) explicitly notes: *Images `![alt](url)` — no IMAGE in FormatMap.* So images are not yet parsed.
- **Outstanding:**
  - **Parser:** Add image syntax to the parser (e.g. lead match for `!??` or similar, mirroring link handling). Emit `on_img(src, title)` and optionally an event for alt text if the renderer needs it (e.g. `on_img(true, src, title, alt)` / `on_img(false, ...)` or a single call with alt).
  - **Renderer (GTK):** In **libocmarkdowngtk**, handle `on_img`: display an image (e.g. load from **src** when it is a URL or file path), with optional title/tooltip and alt text for accessibility. Decide policy for remote URLs (load async, size limits, placeholders on error).
  - **Reference-style images:** `![alt][ref]` — same as reference links: need definitions and resolution so **src** is the resolved URL.
- **References:** 1.10.9-DONE-parser-links.md (link/image syntax similarity), RenderBase.vala `on_img`.

---

## 4. Footnotes

- **Context:** CommonMark and extensions support footnotes, e.g. inline `[^ref]` and a definition block `[^ref]: note text`. Not yet in parser or renderer.
- **Outstanding:**
  - **Parser:** Recognise footnote reference syntax (e.g. `[^label]`) and footnote definition blocks; emit suitable events (e.g. `on_footnote_ref(label)` and `on_footnote_def(label, content)` or equivalent).
  - **Renderer (GTK):** Render footnote refs as superscript/links; render definition block as a footnote section (e.g. at end of block or in a popover). Connect refs to definitions for navigation (click ref → scroll to definition or show tooltip).

---

## 5. Definition lists

- **Context:** Many markdown flavours support definition lists: a term line followed by one or more `: definition` lines. Not yet in parser or renderer.
- **Outstanding:**
  - **Parser:** Recognise definition list syntax (term, then `:` and indented or colon-prefixed definition lines); emit block-level events (e.g. `on_def_list_start` / `on_def_item(term, definition)` / `on_def_list_end` or similar).
  - **Renderer (GTK):** Render term and definition with appropriate styling (e.g. term bold or on its own line, definition indented or under the term).

---

## Summary

| Area                  | Outstanding work |
|-----------------------|------------------|
| **Table width**       | Finalise/adjust column sizing rules and UX; edge cases and resize behaviour. |
| **Reference links**   | Parse link reference definitions; resolve ref label → URL at render/click; decide where resolution lives. |
| **Images**            | Parser: add image syntax and emit `on_img`. Renderer: display image from src, alt/title, and (optional) reference-style image resolution. |
| **Footnotes**         | Parser: footnote ref `[^label]` and footnote definitions. Renderer: ref as superscript/link; definitions as footnote section; ref↔def navigation. |
| **Definition lists**  | Parser: term + `: definition` blocks and events. Renderer: term/definition styling. |

---

## Dependencies

- Table width: builds on 1.10.4, 1.10.5, 1.10.7.
- Reference links: builds on 1.10.9 (parser), 1.10.10 (rendering).
- Images: builds on existing RenderBase `on_img`; parser work is new (similar pattern to links in FormatMap).
- Footnotes: new parser and renderer work; may share ref-definition patterns with reference links.
- Definition lists: new block-level parser and renderer work.
