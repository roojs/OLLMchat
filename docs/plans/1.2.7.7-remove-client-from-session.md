# 1.2.7.7. Remove Client from Session

## Overview

Remove `client` property from `SessionBase` since AgentHandler can get connection from Manager or Session should have connection directly. This is the final tidy-up step after all signal migrations are complete.

**Parent Plan**: [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md)

## Status

⏳ **TODO** - Final phase of signal migration.

## Goal

Remove `client` property from `SessionBase` and update all references to use alternative approaches (e.g., `session.manager.base_client.connection` or add `connection` property to Session).

## Prerequisites

- ✅ All signal migrations complete (Phases 1-5)
- ✅ All signal connections use Chat or direct method calls

## Implementation Steps

### Step 6.1: Remove Client Property from SessionBase

**Goal**: Remove `client` property from `SessionBase` since AgentHandler can get connection from Manager or Session should have connection directly.

**Changes**:
- Remove `public Client client { get; protected set; }` from `SessionBase`
- Remove `this.client = manager.new_client()` from `SessionBase` constructor
- Update `AgentHandler` to get connection from `session.manager.base_client.connection` or add `connection` property to Session
- Update all references to `session.client` to use alternative approach
- Remove `new_client()` method from Manager (or keep for backward compatibility during transition)

**Files to Modify**:
- `libollmchat/History/SessionBase.vala` - Remove `client` property and initialization
- `libollmchat/Prompt/AgentHandler.vala` - Update to get connection from session/manager instead of `session.client.connection`
- `libollmchat/History/Manager.vala` - Consider removing `new_client()` or keeping for compatibility
- All files that reference `session.client` - Update to use alternative approach

**Note**: This is a breaking change and should be done as the final step after all signal migrations are complete.

**Result**: Session no longer has `client` property, all references updated to use alternative approaches

## Files to Modify

- `libollmchat/History/SessionBase.vala` - Remove `client` property and initialization
- `libollmchat/Prompt/AgentHandler.vala` - Update to get connection from session/manager
- `libollmchat/History/Manager.vala` - Consider removing `new_client()` or keeping for compatibility
- All files that reference `session.client` - Update to use alternative approach

## Testing Checklist

- [ ] SessionBase no longer has `client` property
- [ ] AgentHandler gets connection from session/manager without requiring session.client
- [ ] All references to `session.client` updated to use alternative approach
- [ ] All functionality still works correctly
- [ ] No regressions in agent or non-agent usage

## Related Plans

- [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md) - Parent plan
- [1.2.7.6. Remove Signals from Client](./1.2.7.6-remove-signals-from-client.md) - Previous phase
- [1.2.7.8. Cleanup Items](./1.2.7.8-cleanup-items.md) - Next phase
- [1.2. Refactor Client and Chat Relationship](./1.2-refactor-client-chat-relationship.md) - Grandparent plan

