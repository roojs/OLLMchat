# 1.3.3. Configuration Migration Bugs and Defaults

## Overview

This document addresses bugs and default value handling during the migration from Config1 (old config.json format) to Config2 (new config.2.json format), specifically around the `model`, `title_model`, and `think` properties.

## Status

‚è≥ **TODO** - Planning document for configuration migration bug fixes and default handling.

## Related Plans

- **1.3** - Multiple Client Configuration
- **1.3.1** - Configuration Classes
- **1.3.2** - Configuration Interface
- **1.4** - Client Configuration Setup

## Issues to Address

### 1. Default Thinking Value

**Problem**: During migration from Config1 to Config2, the `think` property needs to default to `true`.

**Solution**: 
- When converting Config1 to Config2 in `Config1.toV2()`, ensure that code using `think` assumes `true` as the default if not explicitly set
- The `think` property in Config1 defaults to `true`, so this should be preserved during migration
- Code that accesses `think` should handle the case where it might not be set (default to `true`)

**Location**: `libollmchat/Settings/Config1.vala` - `toV2()` method

### 2. Model and Title Model Defaults

**Problem**: During migration, `model` and `title_model` from Config1 may be empty strings, and code should handle this gracefully.

**Solution**:
- Code that uses `model` and `title_model` can assume empty strings as valid defaults
- When migrating Config1 to Config2:
  - If `model` is empty, it remains empty (no default model is set)
  - If `title_model` is empty, it remains empty (no default title model is set)
- Code accessing these properties should check for empty strings and handle appropriately
- No need to set default values during migration - empty strings are acceptable

**Location**: 
- `libollmchat/Settings/Config1.vala` - `toV2()` method
- All code that accesses `model` and `title_model` properties

## Implementation Notes

### Config1.toV2() Migration

When converting Config1 to Config2:

1. **Connection**: Create Connection from Config1's `url` and `api_key`
2. **Model**: Preserve `model` value (can be empty string)
3. **Title Model**: Preserve `title_model` value (can be empty string)
4. **Think**: Preserve `think` value (defaults to `true` in Config1)

### Code Assumptions

Code throughout the codebase should:
- Assume `model` can be an empty string (no model selected)
- Assume `title_model` can be an empty string (no title model configured)
- Assume `think` defaults to `true` if not explicitly set

### Storage in Config2

**Question**: Where should `model`, `title_model`, and `think` be stored in Config2?

**Options**:
1. As properties on the default Connection object (if they're connection-specific)
2. As separate properties on Config2 (if they're global settings)
3. In `model_options` map (if they're per-model settings)

**Current Status**: Need to determine the appropriate storage location in Config2 structure.

## Files to Modify

- `libollmchat/Settings/Config1.vala` - Update `toV2()` method to preserve these values
- `libollmchat/Settings/Config2.vala` - May need to add properties or storage for model/title_model/think
- All code that accesses `client.config.model`, `client.config.title_model`, `client.config.think` - Ensure they handle empty strings/defaults appropriately

## Migration Strategy

1. Load `config.json` as Config1
2. Convert to Config2 using `toV2()`
3. Preserve:
   - `model` (can be empty)
   - `title_model` (can be empty)
   - `think` (defaults to `true`)
4. Save as `config.2.json`
5. Code accessing these values should handle empty strings and default `think` to `true`

