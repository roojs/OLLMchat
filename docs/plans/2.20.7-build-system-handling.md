# 2.20.7. Build system handling

## Status

✅ **DONE**

## Coding Standards

This plan follows the coding standards defined in `.cursor/rules/CODING_STANDARDS.md`. All code examples in this document should:
- Use `this.` prefix for instance members
- Use `GLib.` prefix for GLib namespace (no `using` statements)
- Use early returns for negative tests
- Avoid nullable types where possible
- Use `.get()` and `.set()` for Gee collections
- Use brace placement: line breaks for classes/methods, inline for control structures

## Purpose

Treat files without a language as documentation. Add "build" category to doc-file analysis so build files can be tagged for dependency extraction.

## Build files list (GtkSourceView .lang globs)

meson.build, meson_options.txt, Makefile, makefile, CMakeLists.txt, Cargo.toml, pyproject.toml, go.mod, build.gradle, pom.xml, package.json.

## Code Changes

### 1. Doc-file prompt: add "build" category

**File**: `resources/ocvector/analysis-doc-file-prompt.txt`

#### 1.1. Replace CRITICAL REQUIREMENTS line (line 10)

Change "8 categories" to "9 categories":

```text
- DO NOT CREATE OR INVENT NEW CATEGORIES - you must use ONLY one of the 9 categories defined below
```

#### 1.2. Add "build" to VALID CATEGORIES

Insert the "build" line after changelog and before other. Update "7 categories" to "8 categories" in the other line:

```text
- changelog: Changelog files, release notes, version history
- build: Build system files, package manifests, dependency configs (e.g. meson.build, CMakeLists.txt, Makefile, package.json, Cargo.toml, pyproject.toml, go.mod, build.gradle, pom.xml). Use so the system can later extract dependencies from their content.
- other: Uncategorized text files that don't fit any of the above 8 categories
```

#### 1.3. Replace line 29 (Generate a single line...)

Change "8 categories" to "9 categories":

```text
Generate a single line in the format "CATEGORY: description" where CATEGORY is exactly one of the 9 categories listed above (use lowercase, no variations), and the description is a short sentence that describes what the document provides or covers.
```

#### 1.4. Replace final REMEMBER line (line 47)

Change "8 categories" to "9 categories" and add "build" to the list:

```text
REMEMBER: You MUST use exactly one of the 9 categories listed above (plan, documentation, rule, configuration, data, license, changelog, build, or other). Do NOT create new categories or use variations of the category names.
```

### 2. DocumentationAnalysis: accept "build"

**File**: `libocvector/Indexing/DocumentationAnalysis.vala`

In `analyze_document()`, in the switch on `category_candidate`, add `case "build":` before `case "other":`.

```vala
				switch (category_candidate) {
					case "plan":
					case "documentation":
					case "rule":
					case "configuration":
					case "data":
					case "license":
					case "changelog":
					case "build":
					case "other":
						root_element.category = category_candidate;
						root_element.description = parts[1].strip();
						break;
```

### 3. Pass basename to language detection

- **Reason:** GtkSourceView globs match on filename only; full path does not match, so build files get null/wrong language.
- **Change:** In `detect_language()`, pass `GLib.Path.get_basename(file.path)` to `guess_language()` instead of `file.path`.

**File**: `liboccoder/BufferProvider.vala`

```vala
		var language = lang_manager.guess_language(GLib.Path.get_basename(file.path), null);
```

## What needs updating

| File | Change |
|------|--------|
| resources/ocvector/analysis-doc-file-prompt.txt | Add "build" category; 8→9 in four places |
| libocvector/Indexing/DocumentationAnalysis.vala | Add `case "build":` in category switch |
| liboccoder/BufferProvider.vala | Pass basename to `guess_language()` |

## Deliverables

- [x] analysis-doc-file-prompt.txt: add "build"; 8→9 in four places
- [x] DocumentationAnalysis.vala: add `case "build":`
- [x] liboccoder/BufferProvider.vala: pass basename to guess_language

## Related Plans

- 2.20.8-project-building.md
- 2.20.5a-project-level-summaries.md
