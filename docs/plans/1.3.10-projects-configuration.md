# 1.3.10. Projects Configuration

## Overview

Implement the Projects tab in the Settings dialog for managing project configurations. This includes the ProjectsPage UI component for listing and removing projects. Projects can be added through the main application interface, but this tab provides a centralized view and removal capability.

## Status

⏳ **TODO** - Not implemented yet.

## Related Plans

- **1.3** - Configuration Overview (see 1.3-DONE-configuration-overview.md)
- **1.3.2** - Configuration Interface (see done/1.3.2-DONE-configuration-interface.md)
- **1.3.9** - Agent Configuration (Agents tab)

## Projects Tab

**Purpose**: View all projects and remove projects (including cleanup of associated file history).

**Components**:
- **List View**: Displays all projects from `ProjectManager.projects`
  - Uses `Adw.BoxedList` for consistent styling
  - Each project shows: project name (path basename), full path (tooltip)
  - Selection support for enabling/disabling remove button
- **Footer Bar**: Bottom action bar with action buttons
  - **Add Button** (left side): Opens file chooser dialog to add a new project folder
    - Note: This may be a placeholder if projects are primarily added through the main application
  - **Remove Button** (right side): Removes selected project
    - Only visible when a project is selected in the list view
    - Shows confirmation dialog before removal
    - Removes all files and file history items associated with the project
    - Does NOT remove the actual files from disk, only removes history and database records

**Data Source**: `ProjectManager.projects` (ProjectList - implements GLib.ListModel)

## Implementation Details

### Files to Create

**ProjectsPage**
- **Location**: `ollmchat/Settings/ProjectsPage.vala`
- **UI Framework**: Uses `Adw.PreferencesPage` with:
  - `Adw.PreferencesGroup` wrapping `Adw.BoxedList` for project list
  - Footer bar (`Adw.ActionBar` or `Gtk.Box`) at bottom with Add and Remove buttons
  - Selection model for list view to track selected project
- **Purpose**: Projects tab content
- **Properties**:
  - `settings_dialog` (SettingsDialog) - Reference to parent SettingsDialog
  - `project_manager` (OLLMfiles.ProjectManager) - Reference to ProjectManager instance
- **Methods**:
  - `add_project()` - Opens file chooser dialog to add a new project folder
  - `remove_project(Folder project)` - Removes project and cleans up associated data
  - `render_projects()` - Creates UI entries from `project_manager.projects` list
  - `on_selection_changed()` - Updates Remove button visibility based on selection

### Files to Modify

- `ollmchat/Settings/SettingsDialog.vala` - Add Projects tab to view stack
- `libocfiles/ProjectManager.vala` - Add `remove_project(Folder project)` method

### ProjectManager.remove_project() Method

**Location**: `libocfiles/ProjectManager.vala`

**Purpose**: Remove a project and clean up all associated data.

**Method Signature**:
```vala
public async void remove_project(Folder project)
```

**Behavior**:
1. **Remove all files from database**: Query and remove all FileBase records where path starts with project path
   - Use SQL query: `DELETE FROM filebase WHERE path LIKE ? || '%' AND delete_id = 0`
   - This removes all files and folders within the project
2. **Remove all file history items**: Query and remove all FileHistory records where path starts with project path
   - Use SQL query: `DELETE FROM file_history WHERE path LIKE ? || '%'`
   - This removes all file history entries for files in the project
   - Also calls `unlink()` on each FileHistory object to remove backup files from disk
3. **Remove project from projects list**: Remove project from `this.projects` list
4. **Clear active project if needed**: If the removed project was the active project, set `this.active_project = null`
5. **Emit signals**: Emit `active_project_changed(null)` if active project was removed
6. **Update database**: Mark database as dirty (`this.db.is_dirty = true`)

**Important Notes**:
- **Does NOT delete files from disk**: This method only removes database records and file history backups
- **Path-based cleanup**: Uses SQL `LIKE` operator with path prefix to find all related records
- **FileHistory cleanup**: Removes both database records and backup files from disk
- **Project removal**: Removes project from in-memory list and database

## Confirmation Dialog

When the user clicks the Remove button, show a confirmation dialog:

**Title**: "Remove Project?"

**Message**: 
```
This will remove all file history and database records for this project.

The actual files on disk will NOT be deleted.

Are you sure you want to remove this project?
```

**Buttons**:
- **Cancel** (default) - Closes dialog without action
- **Remove** (destructive) - Proceeds with project removal

## Integration Points

- **ProjectManager**: Projects are managed by `ProjectManager.projects` (ProjectList)
- **SettingsDialog**: Main dialog window that contains the Projects tab
- **FileBase**: Files are stored in database with path-based queries
- **FileHistory**: File history is stored in database with path-based queries

## UI Layout

```
ProjectsPage (Adw.PreferencesPage)
│
├── Adw.PreferencesGroup
│   └── Adw.BoxedList (project list)
│       ├── [Project 1] (Adw.ActionRow) - Selected state
│       ├── [Project 2] (Adw.ActionRow)
│       └── [Project N] (Adw.ActionRow)
│
└── Footer Bar (Gtk.Box or Adw.ActionBar)
    ├── [Add] Button (left, always visible)
    └── [Remove] Button (right, only visible when project selected)
```

## Future Considerations

- **Project Details**: Show project statistics (number of files, last modified, etc.)
- **Project Settings**: Per-project configuration options
- **Project Export/Import**: Export project configuration and history
- **Bulk Operations**: Select multiple projects for batch removal
