# 3.2. DONE. Session Message Logging

## Overview

Enhanced message logging for sessions to capture all conversation data including streaming tokens, tool execution, and UI messages.

## Status

âœ… **DONE** - Fully implemented with message_created signal system.

## Implementation Details

### Key Changes
1. **Remove `original_content` field** from `Message` class
2. **Add new message roles:**
   - `"user-sent"` - Raw user message before prompt engine modification
   - `"think-stream"` - Accumulated thinking tokens from streaming (created once, updated incrementally)
   - `"content-stream"` - Accumulated content tokens from streaming (created once, updated incrementally)
   - `"ui"` - UI-generated messages from tool_message signals
   - `"end-stream"` - Flag message indicating end of streaming, signals renderer to ignore the next "done" message

3. **Session maintains separate message list** (`messages` property) for serialization
4. **Session listens to Chat signals** and updates its own message list
5. **Message filtering** happens in Session when loading messages back into `chat.messages` for API requests

### Architecture Principles
- **Chat (`OLLMchat/Call/Chat`)**: Only fires signals, does NOT filter or manage special message types
- **Session (`OLLMchat/History/Session`)**: Maintains a separate `messages` list for serialization, listens to Chat signals and updates its own list
- **Separation of Concerns**: `chat.messages` contains only API-compatible messages (system, user, assistant, tool). `session.messages` contains all messages including special types for logging.

### Files to Modify
1. **OLLMchat/Message.vala** - Remove original_content, add new role support
2. **OLLMchat/History/Session.vala** - Update `messages` property to maintain its own list, capture messages from signals, filter on load
3. **OLLMchat/History/SessionBase.vala** - Connect to tool_message signal
4. **OLLMchat/History/SessionPlaceholder.vala** - Filter `messages` when loading into chat.messages
5. **OLLMchatGtk/ChatWidget.vala** - Filter messages when rendering
6. **OLLMchat/Call/Chat.vala** - Remove original_content references only (NO filtering changes)
