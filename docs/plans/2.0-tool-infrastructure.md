# 2.0. Tool Infrastructure

## Overview

Generic infrastructure and base classes for the tool system.

## Status

✅ **DONE** - All base infrastructure is complete.

## Completed Components

### Base Classes
- ✅ **Param Classes** - Parameter definition system (`Param`, `ParamSimple`, `ParamObject`, `ParamArray`)
- ✅ **Tool Base Class** - Abstract base class for all tools (`OLLMchat.Tool`)
- ✅ **Function Class** - Concrete class built from Tool's properties
- ✅ **Permission System** - Abstract permission provider with UI integration (`ChatPermission.Provider`, `ChatPermission.ChatView`)
- ✅ **Tool Execution Infrastructure** - Tool call handling, auto-reply, recursive tool calling
- ✅ **Tool Call Handling** - Automatic tool execution, auto-reply mechanism, recursive tool calling support
- ✅ **Streaming Support** - Streaming works during tool execution

### Key Features
- Parameter description parsing with state machine
- Permission question building
- Async permission requests (non-blocking UI)
- Tool execution and auto-reply mechanism
- Tool call detection in assistant messages
- Automatic tool execution
- Auto-reply mechanism to continue conversation after tool execution
- Recursive tool calling support (multiple tool call rounds before final response)
- Multiple tool calls in one response
- Tool execution failure handling
- Streaming support during tool execution

## Files

- `src/OLLMchat/Ollama/Tool/Param.vala`
- `src/OLLMchat/Ollama/Tool/ParamSimple.vala`
- `src/OLLMchat/Ollama/Tool/ParamObject.vala`
- `src/OLLMchat/Ollama/Tool/ParamArray.vala`
- `src/OLLMchat/Ollama/Tool/Tool.vala`
- `src/OLLMchat/Ollama/Tool/Function.vala`
- `src/OLLMchat/ChatPermission/Provider.vala`
- `src/OLLMchat/ChatPermission/Dummy.vala`
- `src/OLLMchat/ChatPermission/ChatView.vala`
- `src/OLLMchat/Ollama/Message.vala` - Tool call properties (tool_calls, tool_call_id, name)
- `src/OLLMchat/Ollama/Response/ChatResponse.vala` - Tool call detection
- `src/OLLMchat/Ollama/Call/ChatCall.vala` - Tool execution and auto-reply logic
- `src/OLLMchat/Ollama/Client.vala` - Chat() waits for final response
