# Table support Phase 6: BlockMap parser (1.10.6)

Part of the phased implementation for markdown table support; see **1.8.2-table-support-current-design.md** for the overall design and phase order. Depends on **1.10.5-calling-code-types.md** (Parser calling code).

---

## Goal

Implement table detection in **BlockMap** so that a line starting with `|` is only treated as a table after we have 3 full lines ending with `|`. Add `"|"` = TABLE to the marker map; in `peek()`, add a branch for `matched_block == TABLE`: return -1 until we have 3 full lines ending with `|`; then set `byte_length` to those 3 lines (including newlines) and return; else return 0 so the content is treated as regular formatting.

## File

`libocmarkdown/BlockMap.vala`

## Code to add

- In the **static map** (same block as other markers), add: `mp["|"] = FormatType.TABLE;`

- In **peek()**, after the existing branches (fenced code, CONTINUE_LIST), add a branch for `matched_block == TABLE`:
  - Scan from `chunk_pos` for up to 3 lines (split by newline).
  - If we don't have 3 complete lines yet: return -1.
  - If we have 3 lines and each starts with `|` and ends with `|` (and line 2 looks like separator): set `byte_length` to the length of those 3 lines (including newlines) and return the match.
  - Otherwise: return 0.
  - At any point (e.g. line 1 or 2 doesn't end with `|`), return 0 so the parser falls back to normal block/paragraph handling.
