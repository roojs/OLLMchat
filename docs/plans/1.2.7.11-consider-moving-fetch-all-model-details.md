# 1.2.7.11. Consider Moving fetch_all_model_details to Connection

## Overview

Consider moving `fetch_all_model_details()` method from `Client` to `Connection` to better align with the architecture where Connection manages connection-specific data.

**Parent Plan**: [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md)

## Status

⏳ **TODO** - Consideration for future refactoring.

## Goal

Evaluate whether `fetch_all_model_details()` should be moved from `Client` to `Connection`, and if so, implement the move.

## Current State

Currently, `fetch_all_model_details()` is a method on `Client` that:
- Fetches model details from the server
- Populates `client.available_models` HashMap
- Is used in `ConnectionModels.refresh_connection()` by creating a temporary Client instance

**Current Usage**:
- `libollmchat/Settings/ConnectionModels.vala` line 117-119:
```vala
var client = new OLLMchat.Client(connection);
yield client.fetch_all_model_details();
// Then accesses client.available_models.values
```

## Consideration

**Question**: Should `fetch_all_model_details()` be moved to `Connection`?

**Arguments For**:
- Connection-specific: Model details are specific to each connection/server
- Architecture alignment: According to plan 1.2, `available_models` should eventually move to Connection
- Reduces Client usage: Aligns with goal of removing Client references except for simple narrow usages
- More intuitive: `connection.fetch_all_model_details()` is more semantically correct than creating a temporary Client

**Arguments Against**:
- Current approach works: Creating temporary Client is a legitimate "simple narrow usage"
- Breaking change: Would require updating all call sites
- Client already has the infrastructure: HTTP calls, error handling, etc.

## Proposed Implementation

If moving to Connection:

1. Add `available_models` property to `Connection`:
   ```vala
   public Gee.HashMap<string, Response.Model> available_models { get; private set; 
       default = new Gee.HashMap<string, Response.Model>(); }
   ```

2. Move `fetch_all_model_details()` method to `Connection`:
   - Method would use `Connection.soup` for HTTP requests
   - Would populate `connection.available_models` instead of `client.available_models`
   - Would need to create temporary Call objects for HTTP requests (similar to how Client does it)

3. Update `ConnectionModels.refresh_connection()`:
   ```vala
   yield connection.fetch_all_model_details();
   foreach (var model in connection.available_models.values) {
       // ...
   }
   ```

4. Update any other call sites that use `client.fetch_all_model_details()`

## Decision

**Status**: ⏳ **PENDING DECISION**

Need to decide:
- Is this refactoring worth the effort?
- Does it align with the overall architecture goals?
- Should this be done now or deferred to a later refactoring phase?

## Files to Modify (if implemented)

- `libollmchat/Settings/Connection.vala` - Add `available_models` property and `fetch_all_model_details()` method
- `libollmchat/Client.vala` - Remove `available_models` property and `fetch_all_model_details()` method (or keep for backward compatibility)
- `libollmchat/Settings/ConnectionModels.vala` - Update to use `connection.fetch_all_model_details()` instead of creating temporary Client
- Any other files that call `client.fetch_all_model_details()`

## Related Plans

- [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md) - Parent plan
- [1.2.7.7. Remove Client from Session](./1.2.7.7-DONE-remove-client-from-session.md) - Related: removing Client references
- [1.2. Refactor Client and Chat Relationship](./1.2-refactor-client-chat-relationship.md) - Grandparent plan (mentions moving available_models to Connection)

