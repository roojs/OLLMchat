# 1.5. Model List Management

## Overview

Model configuration and management system including default options, per-model overrides, model discovery, and model pulling via Ollama API. Works with client configuration from plan 1.4 to manage models available from connected servers.

## Status

‚è≥ **TODO** - To be implemented.

## Related Plans

- **1.4** - Client Configuration Setup (uses client connections for model discovery)

## Implementation Details

### Current Situation
- Client has a fixed list of available models
- Chat configuration determines which models are active/available
- Need to reconcile these two sources

### Default Model Options
- **Global Defaults**: Default options for all models
- **Per-Model Overrides**: Model-specific option overrides
- **Option Categories**:
  - **Runtime Options**: temperature, top_p, top_k, num_predict, etc.
  - **Context Options**: num_ctx, keep_alive
  - **Format Options**: format (json, schema), stream, think
  - **Model Selection**: default model, title generation model

### Model Options Management UI
- **Model Options Page**: Page for managing models and their options
  - Lists available models from all connections/providers
  - Shows which models are active (in use)
  - Shows model connection/provider for each model
  - Shows per-model option overrides (if any)
  - Add Model button (pull new model via Ollama API)
  - Remove Model button (remove model from server)
  - Edit Options button (opens Model Options Dialog)
  - Edit Default Options button (opens dialog for global defaults)
- **Model Options Dialog**: Dialog for editing model options
  - Options editor (using Call.Options for runtime options: temperature, top_p, top_k, num_ctx, etc.)
  - For per-model overrides: Shows model name (read-only)
  - For default options: Shows "Default Options" label
  - Save/Cancel buttons

### Model Management
- **Model Discovery**: Automatically discover models from connected servers
- **Model Information**: Display model details (size, digest, capabilities)
- **Add Model**: UI for pulling models via Ollama API
  - Model name input
  - Progress indicator during pull
  - Error handling for failed pulls
- **Remove Model**: Option to remove models (via Ollama API if supported)

### Model Configuration Storage
```json
{
  "model_options": {
    "defaults": {
      "temperature": 0.7,
      "top_p": 0.9,
      "top_k": 40,
      "num_ctx": 2048,
      "stream": true,
      "think": true
    },
    "overrides": {
      "llama3": {
        "temperature": 0.5,
        "num_ctx": 4096
      },
      "mistral": {
        "temperature": 0.8,
        "top_p": 0.95
      }
    }
  },
  "default_model": "",
  "title_model": ""
}
```

### Model Pull Integration
- **Ollama Pull API**: Use `POST /api/pull` endpoint
- **Progress Tracking**: Show download progress
- **Error Handling**: Handle network errors, invalid model names
- **Model Selection**: After pull, offer to configure options

### Settings Priority
1. **Per-chat overrides** (highest priority)
2. **Per-model options** (from settings)
3. **Global defaults** (from settings)
4. **System defaults** (lowest priority)

### Features
- Display models from client's available models list
- Filter/activate models based on Chat configuration
- Update model dropdown based on active Chat
- Handle model availability changes when switching chats

### Files to Create
- `ollmchat/Settings/ModelsPage.vala` - Models settings page (lists available models from all providers)
- `ollmchat/Settings/ModelOptionsDialog.vala` - Dialog for editing model options (used by Models Page for default and per-model overrides)
- `libollmchat/Call/Pull.vala` - Pull API call class for downloading models

**Note**: The `model_options` section uses the existing `Call.Options` class for default and per-model overrides.

### Files to Modify
- `libollmchat/Config.vala` - Add model options storage
- `libollmchat/Client.vala` - Apply model options to chat calls
- `libollmchatgtk/ChatWidget.vala` - Model dropdown
- `libollmchat/Client.vala` - Available models list
- `libollmchat/Call/Chat.vala` - Chat configuration

### Implementation Notes
- Review current model list implementation
- Understand how Chat configuration affects model availability
- Ensure model list updates when switching between chats
- Handle cases where Chat's configured model isn't in client's available list

### Future Considerations
- **Model Profiles**: Named sets of model options
- **Model Switching**: Quick switching between model configurations
- **Model Comparison**: Compare model outputs with different settings
