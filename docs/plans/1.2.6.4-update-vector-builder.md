# 1.2.6.4. Update VectorBuilder

## Overview

Update VectorBuilder to take `Connection` and `model` instead of `Client`.

**Parent Plan**: [1.2.6. Update Legacy Methods](./1.2.6-update-legacy-methods.md)

**Prerequisite**: [1.2.6.1. Update Client Method Signatures](./1.2.6.1-update-client-method-signatures.md) must be complete

## Status

‚è≥ **TODO** - Needs implementation.

## Goal

VectorBuilder should not depend on `Client` with config. According to plan 1.2, Manager owns the config, not Client.

## Current Implementation

**File**: `libocvector/Indexing/VectorBuilder.vala` (line 106)

```vala
public VectorBuilder(OLLMchat.Client client, Database database, SQ.Database sql_db)
{
    this.client = client;
    // ...
}
// ...
var embed_response = yield this.client.embed_array(documents);
```

**Problem**: VectorBuilder takes `Client` but should take `Connection` and model.

## Proposed Fix

```vala
private Settings.Connection connection;
private string model;

public VectorBuilder(Settings.Connection connection, string model, Database database, SQ.Database sql_db)
{
    this.connection = connection;
    this.model = model;
    this.database = database;
    this.sql_db = sql_db;
    
    // Initialize SQL schema if needed
    VectorMetadata.initDB(sql_db);
}

public async void process_file(Tree tree) throws GLib.Error
{
    // ... prepare documents ...
    
    // Create client from connection (no config - Manager owns config)
    var client = new Client(this.connection);
    var embed_response = yield client.embed_array(this.model, documents);
    
    // ... rest of implementation ...
}
```

## Implementation Steps

1. Update `VectorBuilder` constructor to take `Connection` and `model`
2. Update `process_file()` method to create Client from Connection
3. Find all call sites of VectorBuilder constructor and update them
4. Test that vector building still works

## Test

Verify vector building still works for code indexing.

## Result

VectorBuilder uses model parameter explicitly and no longer depends on Client with config.

## Files to Modify

- `libocvector/Indexing/VectorBuilder.vala` - Update constructor and `process_file()` method
- Find and update all VectorBuilder constructor call sites

## Related Plans

- [1.2.6.1. Update Client Method Signatures](./1.2.6.1-update-client-method-signatures.md) - Prerequisite

