# Indexer.vala — project analysis wiring — ⏳ NEEDS DOING

**File:** `libocvector/Indexing/Indexer.vala`

Add project-level analysis after folder indexing: new private method and a change in `index_filebase`.

**ProjectAnalysis API (see 2.20.5-project-level-summaries):** Constructor takes `root_folder`; `metadata_keymap` is a property (caller may set from FolderAnalysis.analyze_children, or leave unset and ProjectAnalysis builds from DB). `extract_dependencies()` and `analyze()` take no arguments.

---

## 1. New method: `index_project`

Run dependency extraction then project summary for the root folder. Call it after `index_folder()` so file (and optionally folder) metadata exist in the DB. `force` is for API consistency with `index_folder`; no skip logic required.

```vala
private async void index_project(OLLMfiles.Folder root_folder, bool force) throws GLib.Error
{
	var project_analysis = new ProjectAnalysis(this.config, this.sql_db, root_folder);
	yield project_analysis.extract_dependencies();
	// Optional: project_analysis.metadata_keymap = keymap from FolderAnalysis.analyze_children
	yield project_analysis.analyze();
}
```

---

## 2. Change in `index_filebase`

When the target is a folder: index files, then run project analysis, then return the file count.

**Current folder branch:**
```vala
return yield this.index_folder((OLLMfiles.Folder)filebase, recurse, force);
```

**Replace with:**
```vala
if (filebase is OLLMfiles.Folder) {
	var folder = (OLLMfiles.Folder)filebase;
	int n = yield this.index_folder(folder, recurse, force);
	yield this.index_project(folder, force);
	return n;
}
```
