# 1.5.1. Remove Model Support

## Overview

Add the ability to remove models from the server via the Ollama API. When a model row is expanded in the ModelsPage, users will see an additional option to remove the model. This requires a confirmation dialog warning about model size and download time, since models are large and re-downloading them takes significant time.

**Parent Plan**: [1.5. Model List Management](./1.5-DONE-model-list-management.md)

## Status

‚è≥ **PENDING** - Not yet started

## Goal

1. Add remove model API support in `Call.Base` (create `Call.Delete` class)
2. Add remove button/row to expanded model options in `ModelRow`
3. Implement confirmation dialog with warning about model size and download time
4. Handle model removal and refresh the model list after successful deletion

## Related Plans

- **1.5** - Model List Management (parent plan)
- **1.4** - Client Configuration Setup (uses client connections)

## Implementation Details

### API Support

#### Create `Call.Delete` Class

Create a new API call class for deleting models, following the pattern of `Call.Pull`:

**File**: `libollmchat/Call/Delete.vala`

```vala
namespace OLLMchat.Call
{
    /**
     * API call to delete a model from the Ollama server.
     *
     * Deletes a model by name using the Ollama delete API endpoint.
     * This permanently removes the model from the server.
     */
    public class Delete : Base
    {
        public string name { get; set; default = ""; }

        public Delete(Settings.Connection connection, string model_name)
        {
            base(connection);
            if (model_name == "") {
                throw new OllmError.INVALID_ARGUMENT("Model name cannot be empty");
            }
            this.name = model_name;
            this.url_endpoint = "delete";
            this.http_method = "DELETE";
        }

        /**
         * Executes the delete API call.
         *
         * @throws Error if the request fails or response is invalid
         */
        public async void exec_delete() throws Error
        {
            var url = this.build_url();
            var request_body = this.get_request_body();
            var message = this.connection.soup_message(this.http_method, url, request_body);

            GLib.debug("Delete request URL: %s", url);
            GLib.debug("Delete request Body: %s", request_body);

            var bytes = yield this.send_request(true);
            
            // Delete endpoint typically returns empty response or simple confirmation
            // No need to parse response for delete operations
        }
    }
}
```

**Note**: The Ollama delete API uses `DELETE` HTTP method to the `/api/delete` endpoint with a JSON body containing the model name.

### UI Changes

#### Add Remove Button to ModelRow

When a model row is expanded, add a remove button/row that triggers the deletion process.

**File**: `ollmapp/SettingsDialog/ModelRow.vala`

- Add a remove button row when the model is expanded
- Button should be styled as a destructive action (red/warning color)
- Position the remove button after the options widget rows
- Connect button click to show confirmation dialog

#### Confirmation Dialog

Create a confirmation dialog that warns users about:
- Model deletion is permanent
- Models are large files and take time to download
- Re-downloading deleted models will take significant time
- Only delete if you're sure or running low on space

**Dialog Content**:
- Title: "Delete Model?"
- Message: "Are you sure you want to delete '{model_name}'? This will permanently remove the model from the server. Models are large files and re-downloading them may take a significant amount of time. Only delete if you're certain or running low on disk space."
- Primary action: "Delete" (destructive style)
- Secondary action: "Cancel"

**Implementation**:
- Use `Adw.MessageDialog` for the confirmation dialog
- Show dialog when remove button is clicked
- If confirmed, execute the delete API call
- Show error dialog if deletion fails
- Refresh model list after successful deletion

### Model List Refresh

After successful model deletion:
- Remove the model from the UI immediately
- Optionally refresh the entire model list from the server (via `ModelsPage.render_models()`)
- Update the model list to reflect the deletion

### Error Handling

- Handle network errors during deletion
- Handle cases where model is in use (if server returns error)
- Show appropriate error messages to the user
- Ensure UI state is consistent even if deletion fails

## Files to Create

- `libollmchat/Call/Delete.vala` - Delete API call class for removing models

## Files to Modify

- `ollmapp/SettingsDialog/ModelRow.vala` - Add remove button/row when model is expanded
- `ollmapp/SettingsDialog/ModelsPage.vala` - Handle model removal and refresh list

## Implementation Notes

- Follow the same pattern as `Call.Pull` for API call implementation
- Use `Adw.MessageDialog` for confirmation (consistent with GTK4/Adwaita patterns)
- Ensure the delete button is clearly marked as a destructive action
- Consider showing model size in the confirmation dialog if available from model metadata
- The delete operation should be cancellable (use `Cancellable` from `Call.Base`)
- After deletion, the model should disappear from the list immediately without requiring a manual refresh

## API Reference

Ollama Delete API:
- **Endpoint**: `DELETE /api/delete`
- **Request Body**: `{"name": "model_name"}`
- **Response**: Empty or simple confirmation JSON

## Future Considerations

- **Bulk Delete**: Allow deleting multiple models at once
- **Model Size Display**: Show model size in the confirmation dialog
- **Usage Check**: Warn if model is currently in use by any chat
- **Undo Support**: Keep deleted models in a "recently deleted" list for quick restore (if server supports it)
