# 3.3. Chat History System

## Overview

Comprehensive chat history system for OLLMchat, including persistent storage, browsing, restoration, and advanced features like chat rewinding and multiple chat sessions.

## Status

✅ **MOSTLY DONE** - Core functionality implemented. Some advanced features may still be pending.

## Implementation Details

### Features
- Save all chat conversations to disk in a structured format
- Provide a summary index for quick browsing
- Use LLM to generate meaningful titles for conversations
- Enable browsing and restoring old conversations
- Support advanced features like hidden messages and chat rewinding
- Support multiple concurrent chat sessions
- Transform the test-window into a proper `ollmchat` application with about dialog and polished UI

### Directory Structure

```
~/.local/share/ollmchat/
└── history/
    ├── 2025/
    │   └── 01/
    │       └── 15/
    │           ├── 14-30-45.json    # Individual chat session files
    │           └── 15-22-10.json
    └── ...
```

**Note**: Summary index is stored in SQLite database using `SQ/Database.vala` instead of `history.json`.

### File Format

Each chat session is saved as a JSON file with:
- `id` - Session identifier
- `updated_at` - Last update timestamp
- `title` - LLM-generated title
- `model` - Model used
- `child_chats` - Array of child chat IDs
- `messages` - Array of message objects

### Implemented Components
- ✅ History Manager (`OLLMchat.History.Manager`) - Manages sessions and SQLite database
- ✅ Session classes (`Session`, `SessionBase`, `SessionPlaceholder`, `EmptySession`) - Session persistence
- ✅ HistoryBrowser widget (`OLLMchatGtk.HistoryBrowser`) - UI for browsing sessions
- ✅ SQLite database for session metadata
- ✅ JSON file storage for complete session data
- ✅ Session loading and switching
- ✅ Message persistence with special roles (user-sent, think-stream, content-stream, ui, end-stream)

### Future Enhancements
- Full client_config support: Load and restore full client configuration (api_key, keep_alive, etc.) from config system using URL as identifier
- Advanced features like hidden messages and chat rewinding
- LLM-generated titles for conversations (may be implemented)
- Transform test-window into proper `ollmchat` application with about dialog
