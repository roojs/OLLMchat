# 1.2.7.18. ChatView.append_complete_assistant_message() - Get Chat and Client from Session

## Overview

`ChatView.append_complete_assistant_message()` currently tries to get Chat from `message.message_interface` with a fallback to `session.agent.chat`, and gets client from `session.client`. This approach has FIXME comments indicating it needs cleanup.

**Parent Plan**: [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md)

## Status

‚è≥ **TODO** - Cleanup phase after signal migration.

## Goal

Clean up how Chat and Client are obtained in `ChatView.append_complete_assistant_message()`.

## Issue

`ChatView.append_complete_assistant_message()` currently tries to get Chat from `message.message_interface` with a fallback to `session.agent.chat`, and gets client from `session.client`. This approach has FIXME comments indicating it needs cleanup.

## Current State

- `libollmchatgtk/ChatView.vala` lines 641-655:
```vala
// Get client and chat from message or session
// FIXME - we want to get rid of this message_interface klduget
var call = message.message_interface as OLLMchat.Call.Chat;
if (call == null) {
    // Fallback: try to get chat from session's agent
    if (session.agent != null && session.agent.chat != null) {
        call = session.agent.chat;
    } else {
        GLib.warning("ChatView.append_complete_assistant_message: cannot get Chat from message or session");
        return;
    }
}
// FIXME = need to get connection from elsewhere? sesison?
var client = session.client;
```

## Action

- Review how Chat and Client should be obtained in this context
- Remove dependency on `message.message_interface` 
- Determine proper way to get connection/client (may relate to Phase 6 removal of `session.client`)
- Update code to use cleaner approach

## Files to Modify

- `libollmchatgtk/ChatView.vala` - Update `append_complete_assistant_message()` method

## Testing Checklist

- [ ] `ChatView.append_complete_assistant_message()` gets Chat and Client correctly
- [ ] All functionality still works correctly after cleanup

## Related Plans

- [1.2.7. Move Remaining Signals from Client to Chat](./1.2.7-move-signals-to-chat.md) - Parent plan
- [1.2.7.8. Cleanup Items](./1.2.7.8-cleanup-items.md) - Related cleanup item

