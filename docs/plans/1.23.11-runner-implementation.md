# 1.23.11 Runner Implementation (single plan)

**Note:** Do not add sentences to this plan unless specifically asked — only bullet points or nested bullet points.

**Coding standards:** All proposed code in this plan must follow `.cursor/rules/CODING_STANDARDS.md`. Before implementation, verify against the checklist there. This plan’s code uses: **this.** for instance members (including in callbacks: this.run_child, this.wait_exec_done (callbacks inline num_exec_running--)); **var** for initializers where type is not required; **item.children** and **children.get(0)** (Gee .get(), not []); **continue** to avoid else in loops; inline braces for control structures (if/foreach); **GLib.Error**; no underscore names; no get_* for simple accessors.

---

## Overview

- Sub-plan of **1.23.2**. Single plan for all Runner (orchestrator) work; plans 1.23.8, 1.23.9, 1.23.10 merged here.
- Flow: task creation (initial) → run reader tasks (research/plan) → if writer tasks and no approval yet, ask user to approve → run writer tasks (modify) → loop or conclude. No separate "post list" that suggests change tasks; a task that changes something is a normal (writer) task.
- Parsing, Task-built precursor (no PrecursorBuilder), and orchestration are defined in this plan; prompt content and output formats are in 1.23.3–1.23.6.

**Status:** PLAN — Implementation not started.

**Dependencies:** 1.23.2, 1.23.3–1.23.6 (formats), 1.23.1 (existing Runner/Manager/Definition), 1.23.12 (context restriction format), 1.23.13 (task-related code), 1.23.14 (existing skill code), 1.23.17 (template changes). **project_description** source: active project's **summary()** (2.20.5 project-level summaries in vector_metadata); if not completed, summary may be empty.

---

## Classes to change

- **Runner** — Entry, loop, prepare_tasks, writer approval, template-by-key usage. See **1.23.14**.
- **TaskList** — steps, refine, run_until_writer, run_child, has_writer_tasks, run_all_tasks (Runner calls run_post_completion() directly after). See **1.23.13**.
- **TaskStep** — Wrapper (children), has_writer_task(), wait_refined(). See **1.23.13**.
- **Task** — is_writer, wait_refined(), refine(), run_tools(), post_evaluate(). See **1.23.13**.
- **PromptTemplate** — See **1.23.17** (template changes). Runner uses template(filename) and fill per 1.23.17; see 1.23.14 for call sites.
- **Factory** — skill-prompts + resources/skills; Runner creation for run_async. See **1.23.14**.
- **Manager** — Skill catalog for task creation; resolve by name. See **1.23.14**.
- **Definition** — Skill input requirements for refinement; full_content for executor. See **1.23.14**.

- See **1.23.13** for task-related code (TaskList, TaskStep, Task, parsers, Task-built precursor).
- See **1.23.14** for updates to existing skill code (Runner, PromptTemplate, Factory, Manager, Definition).

---

## Deliverable

- All Runner behaviour in one plan: parsing (1.23.3–1.23.6), Task-built precursor (no PrecursorBuilder), refinement, execution, post completion, loop, errors, context restriction.
- Implementation is done by changing the classes above and adding the new parsing pieces; Task handles precursor.

---

## References

- 1.23.2 (orchestration, conventions); 1.23.3 (task creation format); 1.23.4 (refinement + skill call format); 1.23.5 (post completion format); 1.23.6 (executor format); 1.23.12 (code blocks, context restriction); 1.23.1 (existing Skill Runner); 1.23.13 (task-related code); 1.23.14 (existing skill code).
