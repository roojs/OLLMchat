# 1.14. URGENT - Add Current Date to System Prompt Injection

## Overview

Add the current date to the system prompt injection in the "CodeAssistant" agent. The system prompt injection already exists via the `generate_user_info_section()` method, which includes OS Version, Workspace Path, and Shell. This change will add the current date to that section so the LLM has temporal context.

**Note**: This change applies only to CodeAssistant. JustAsk is left unchanged for now.

## Status

‚è≥ **TODO** - Not yet implemented.

## Problem

The LLM gets confused about all of the complexity in the current system prompts, tool descriptions, and agent configurations. The system prompt injection already exists in the `generate_user_info_section()` method, but it doesn't include the current date and time, which would provide useful temporal context to the LLM.

## Solution

Add the current date and time to the `generate_user_info_section()` method in `BaseAgent`. This method is already used by both Just Ask and CodeAssistant agents to inject system information into their prompts. Adding date/time will give the LLM temporal awareness.

## Implementation Details

### Phase 1: Add Date and Time to generate_user_info_section()

#### File: `libollmchat/Prompt/BaseAgent.vala`

Modify the `generate_user_info_section()` method to include the current date and time:

```vala
protected virtual string generate_user_info_section()
{
    var result = "<user_info>\n";
    result += "OS Version: " + this.get_os_version() + "\n";
    
    // Add current date and time
    var now = new DateTime.now_local();
    var date_str = now.format("%Y-%m-%d");
    var time_str = now.format("%H:%M:%S %Z");
    result += "Current Date: " + date_str + "\n";
    result += "Current Time: " + time_str + "\n";
    
    var workspace_path = this.get_workspace_path();
    if (workspace_path != "") {
        result += "Workspace Path: " + workspace_path + "\n";
    }
    
    if (this.shell != "") {
        result += "Shell: " + this.shell + "\n";
    }
    result += "</user_info>";
    return result;
}
```

### Phase 2: Verify Both Agents Use This Method

#### Just Ask Agent
**File**: `libollmchat/Prompt/JustAsk.vala`

JustAsk doesn't override `generate_user_info_section()`, so it will automatically use the updated BaseAgent implementation. However, JustAsk also doesn't call `generate_user_info_section()` in its `generate_system_prompt()` (which returns empty), so we need to check if JustAsk should include user info.

#### CodeAssistant Agent
**File**: `liboccoder/Prompt/CodeAssistant.vala`

CodeAssistant overrides `generate_user_info_section()` and calls it in `generate_system_prompt()`. We need to update CodeAssistant's override to include date/time as well, or remove the override to use the base implementation.

**Decision**: Update CodeAssistant's `generate_user_info_section()` override to include date/time, or remove the override to inherit from BaseAgent.

## Related Plans

- **1.7** - Agent Management System (agent registration and management)
- **4.5** - Coding Agent Missing Bits (CodeAssistant implementation)
- **2.10** - Codebase Search Tool (tool used by CodeAssistant)

## Files to Modify

1. `libollmchat/Prompt/BaseAgent.vala` - Add date and time to `generate_user_info_section()` method
2. `liboccoder/Prompt/CodeAssistant.vala` - Update `generate_user_info_section()` override to include date/time (or remove override to use base implementation)

## Usage Example

After implementation, the user info section will automatically include date and time:

```
<user_info>
OS Version: linux 6.14.0-37-generic
Current Date: 2025-01-15
Current Time: 14:30:45 PST
Workspace Path: /home/user/project
Shell: /usr/bin/bash
</user_info>
```

## Notes

- Date format: YYYY-MM-DD (e.g., "2025-01-15")
- Time format: HH:MM:SS TZ (e.g., "14:30:45 PST") - includes timezone
- Uses `DateTime.now_local()` to get the current local date and time
- Both JustAsk and CodeAssistant will benefit from temporal context
- The date/time is generated fresh each time `generate_user_info_section()` is called, so it's always current
