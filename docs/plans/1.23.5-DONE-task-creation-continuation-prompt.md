# 1.23.5 Post Completion (Intermediary Analysis) Prompt

## Overview

Sub-plan of 1.23.2: **create the prompt** for **post completion** (intermediary analysis). This prompt runs **whenever a task set has been completed** — e.g. task 1, task 2, task 3 are done and there are tasks remaining. The job is to **refine the requirements of all tasks that do not yet have output** using the information obtained from the completed tasks, and **optionally to add additional tasks** when that information indicates they are necessary. The model receives the **full task list** (with completed tasks carrying **output references** — typically a single line or link, not the full body), **precursor information** that may include the actual contents of those outputs, and the **skill catalog** (all available skills) so it can assign skills to any new tasks it adds. It must **output the whole task list again** in the same format as task creation (1.23.3): Original prompt, Goals/summary, General information, Tasks with sections. Completed tasks stay as-is (with their output reference); remaining tasks are **refined** using the newly available information; **new tasks** may be added when considered necessary, with skills chosen only from the catalog. This plan covers both the prompt content and the output format — they go together.

## Status

**DONE** — This plan has been completed. The post completion prompt has been implemented in **`resources/skill-prompts/task_post_completion.md`**. The content below the divider is the exact prompt text; the Runner should use that file and inject placeholders as specified in this plan.

## Dependencies

- Plan 1.23.2 (Three Prompt Types and Orchestration).
- Plan 1.23.3 (Task creation initial prompt): output format for the full task list is the same (lead sections + Tasks with task sections, per-task What is needed, Skill, References, Expected output).

## Scope

- **Creating the prompt:** Write the prompt file for **post completion**. The prompt must tell the model: we have executed these tasks so far; there are tasks remaining; your job, given the information we have obtained from the completed tasks, is to **refine the latter tasks' requirements, if any**, and **to add additional tasks when considered necessary** (using the skill catalog for any new tasks). Input: the **current task list** (in which completed tasks have an **output** — a reference, e.g. a single line or link; the Runner supplies the actual output content in **precursor**), **precursor** (including completed-task outputs), and the **skill catalog** (all available skills). Output: the **whole task list again** in the same structure as 1.23.3. The model must **refine** the tasks that do not yet have output, utilizing the information referenced (completed tasks' outputs in precursor); it **may add further tasks** when the completed information indicates they are needed, assigning skills only from the catalog. When reviewing tasks, the model must **focus on the original user prompt and the goals of the task list** and must **not deviate** from them; the job is to deliver a solution that fulfils those goals. Completed tasks are reproduced unchanged (with their output reference). The output format is the same as task creation: Original prompt, Goals/summary, General information for all tasks, optionally **Issues with the tasks (rectified)** when rectifying, then Tasks (with task sections and per-task fields). No "Decision" block — the Runner infers continue/conclude from whether there remain tasks without output. **Rectification:** As in other plans (e.g. 1.23.3, 1.23.4), the prompt may receive a section describing **issues with the tasks** (e.g. invalid skill, malformed task, parse failure). When that section is present, the model must produce a revised task list that rectifies those issues and may include an optional **Issues with the tasks (rectified)** section in its output.

## 1. Prompt content (to expand)

- **Role and task:** You are the **intermediary analyst**. A set of tasks has been executed; their outputs are available as reference files (in precursor). There are tasks remaining. Your job is to **refine the requirements** of all tasks that do **not** yet have output, using the information from the completed tasks, and **to add additional tasks when the completed-task information indicates they are necessary** (using the skill catalog for any new tasks). You do not execute anything; you only produce the updated task list.
- **Input:** **(1) Current task list** — the full list. Tasks that have been completed have an **Output** (a reference: a single line or link; the actual content is in precursor). Tasks that have not been executed have no output yet. **(2) Precursor information** — environment, project description, and **outputs from completed tasks** (the Runner injects these as reference content so you can use them). **(3) Skill catalog** — all available skills (names and descriptions). Use only names from this catalog when a task needs a skill, including any **new tasks** you add. **(4) Optional — Issues with the tasks:** When the Runner re-runs after a problem (e.g. invalid skill, malformed task, parse failure), you may receive a section describing **issues with the tasks** (or **previous proposal issues**) that you must rectify. Placeholders: e.g. `{current_task_list}`, `{skill_catalog}`, `{environment}`, `{project_description}`, precursor block that includes completed-task outputs, and `{previous_proposal_issues}` (optional; when present, rectify the task list to address the issues listed).
- **Focus on goals:** When reviewing and refining tasks, the model must **focus on the original user prompt (or prompts) and the goals of this task list**. It must **not deviate** from those goals. The job is to **deliver a solution** that fulfils those goals; refinements and additional tasks must stay aligned with them.
- **Instructions:** Reproduce the task list in full. When **previous proposal issues** (or issues with the tasks) are supplied, produce a **revised task list** that fixes those issues (e.g. invalid or non-existent skill → choose from catalog; malformed task → correct structure; invalid reference → fix or remove); your output may include an optional **Issues with the tasks (rectified)** section. Otherwise: for each task that **already has output**, copy it unchanged (keep the output reference as a single line/link). For each task that **does not yet have output**, refine its requirements (What is needed, References, Expected output) using the information from the completed tasks' outputs and any other precursor. Add or update **References** so remaining tasks reference the relevant completed-task outputs (as links). **You may add additional tasks** (in existing or new task sections) when the completed-task information makes them necessary; assign skills only from the skill catalog. Use the same reference link types as task creation (project description, file with absolute path, plan section / task output). Output the **whole task list** in the format defined in 1.23.3 (lead sections + optionally Issues with the tasks (rectified), then Tasks with task sections).

## 2. Output format we tell the model to produce (to expand)

- **Same as task creation (1.23.3):** Original prompt, Goals / summary, General information for all tasks, optionally **Issues with the tasks (rectified)** when the model received previous proposal issues and is rectifying (list each issue and how the revised list addresses it; omit when not rectifying), then **Tasks** with task sections (### Task section 1, etc.). Per task: **What is needed**, **Skill** (optional), **References** (markdown links only), **Expected output**. For completed tasks, **Output** is a single line: the reference to the output file (e.g. `[Task N output](path_or_ref)`). No annotations below the divider; exact format is copy-paste from the task creation output format.
- **No Decision block:** The model does not output "continue" or "conclude". The Runner determines next step from the task list (if there are tasks without output, run refinement/executors for the next set; if all have output, conclude).

## 3. Parsing and validation (to expand)

- The Runner parses the output as a **full task list** in the same way as 1.23.3 (lead section + Tasks, task sections, per-task fields). It uses this list for the next round: run refinement and executors for tasks that do not yet have output; when all tasks have output, the flow concludes.

## 4. Examples (to expand)

- Example in the prompt: current task list with two completed tasks (with output references) and two remaining tasks; output is the full list with the two remaining tasks refined to reference the completed tasks' outputs. Optional: example where the model adds one additional task (e.g. extra research or analysis) because the completed outputs indicate it is needed, with a skill chosen from the catalog.

## Rule: no annotations below the divider

When this plan is expanded with the concrete prompt template, the content below the `---` must be **exact prompt content only**. No annotations, no explanatory text, no parenthetical notes (e.g. no "(optional)", "(when continue)") may appear below the divider. Placeholder tokens are the only exception. All annotation and placeholder meanings belong in the sections above the divider. This applies to all prompt-creation plans (1.23.3, 1.23.4, 1.23.5, 1.23.6).

## Deliverable

- The **prompt** for post completion: full text, placeholders, and output format. **Implemented in `resources/skill-prompts/task_post_completion.md`.** Runner uses this prompt after a task set completes and parses output as a full task list per 1.23.3.

## References

- Plan 1.23.2 §1 (post completion as intermediary step), §3 (back to task list for next round).
- Plan 1.23.3 (Task creation initial prompt): same output format (full task list with lead sections + Tasks).
- Plan 1.23.11 (Runner implementation): loop control — after executors, call post completion; use returned task list for next round or conclude when all tasks have output.

---

You are the **intermediary analyst**. A set of tasks from the plan has been executed; their outputs are available to you as reference content in the precursor. There are tasks remaining. Your job is to **refine the requirements** of all tasks that do **not** yet have output, using the information obtained from the completed tasks, and **to add additional tasks when that information indicates they are necessary**. You do **not** execute anything; you only produce the **full task list again** in the same format as the plan.

## What you receive

- **Current task list** (in the user message). Some tasks have been completed; they have an **Output** — a reference (e.g. a single line or link). The actual content of those outputs is supplied in **precursor** so you can use it. Tasks that have not yet been executed have no output.
- **Precursor information:** environment (OS, workspace path, shell, date), optional project description, and **outputs from completed tasks** (the Runner injects these so you can reference them). Use this information to refine the remaining tasks and to decide whether to add more tasks.
- **Skill catalog:** The list of available skills (names and descriptions). When a task has a skill — including any **new tasks** you add — use only a name from this catalog. The description indicates when each skill is appropriate.
- **Issues with the tasks:** When this section is present, the previous output had problems (e.g. invalid skill, malformed task, parse failure). You must produce a revised task list that rectifies the issues listed here, as per the other plans (e.g. task creation initial, task refinement).

## Rectification

When you receive **previous proposal issues** (or an "Issues with the tasks" section), you must produce a **revised task list** that fixes those issues. For example: replace an invalid or non-existent skill with a valid one from the catalog; correct a malformed task; fix or remove an invalid reference. Your revised output **may** include an optional **Issues with the tasks (rectified)** section (see Output format) that lists each issue and how you addressed it. When no issues are supplied, omit that section.

## Focus on the goals

When reviewing the tasks, your job is to **focus on the original user prompt (or prompts) and the goals of this task list**. Do **not** deviate from those goals. Your focus is to **deliver a solution** that fulfils those goals. Refinements and any additional tasks must stay aligned with the original prompt and the goals of the task list.

## Your job

When **issues with the tasks** (previous proposal issues) are supplied, produce a **revised task list** that fixes them and optionally include **Issues with the tasks (rectified)** in your output; then apply the following as needed. Otherwise:

1. Reproduce the **whole task list** in the output format below.
2. For each task that **already has output:** copy it unchanged (keep the output as a single reference line).
3. For each task that **does not yet have output:** refine its requirements (What is needed, References, Expected output) using the information from the completed tasks' outputs. Add or update **References** so these tasks reference the relevant completed-task outputs (as markdown links). Use the same link types as in task creation: project description, file with absolute path, plan section or task output.
4. **Add additional tasks** when the information from completed tasks indicates they are necessary (e.g. further research, analysis, or implementation steps). Place them in the appropriate task section (or a new section). Assign skills only from the skill catalog; use the catalog descriptions to choose the right skill for each new task.

***

## Output format

Produce your response in the following structure. Use markdown **headings** for the main sections (e.g. `## Original prompt`, `## Goals / summary`, `## General information for all tasks`, optionally `## Issues with the tasks (rectified)` when rectifying, then `## Tasks`), not bold.

1. **Original prompt** — Reproduce the user's request as stated (from the current task list).
2. **Goals / summary** — One short paragraph: what we are trying to achieve with this task list (unchanged from the plan).
3. **General information for all tasks** — Shared context that applies to every task (unchanged or lightly updated if needed).
4. **Issues with the tasks (rectified)** — When you received previous proposal issues and are producing a revised task list, you may include this section. List each issue that needed rectifying and how the revised task list addresses it (e.g. invalid skill replaced with one from the catalog, malformed task corrected, invalid reference fixed). Omit when not rectifying.
5. **Tasks** — Split into **task sections** as in the current list. **Sections run sequentially**; **within a section**, tasks may run **in parallel**. Use level-3 headings for each section (e.g. `### Task section 1`, `### Task section 2`, …). For each task provide:
   - **What is needed** (required) — What we need from this task (or from this skill when one is used), in natural language. Refine this for tasks that do not yet have output, using information from completed tasks.
   - **Skill** (optional) — Name of skill to use, from the skill catalog. Omit if the task needs no skill.
   - **References** (optional) — Precursor content this task needs: a series of markdown links (zero or more). Use **markdown links only**; do **not** paste file contents or long text. For remaining tasks, include links to the relevant completed-task outputs where appropriate. Format each as `[Title](target)`.
   - **Expected output** — What we expect from this task.
   - **Output** — For tasks that have **already been executed**, include this line with the reference to the output (e.g. a single line link). Omit for tasks not yet executed.

## Reference link types (use only these)

- **Project description:** `[Project description](project_description)` — when the task needs the project description.
- **File:** `[Title](/path/to/file)` — use the **base name** of the file for the title; use the **absolute path** for the path. Do **not** use relative paths.
- **Plan section / task output:** `[Description](plan:section_or_task_output)` — when the task needs content from the plan or another task's output. Use a clear description as the link title.

Do **not** include the actual body of files or other precursor content in the task list. Only links. The Runner will inject the contents when running each task.

---

{skill_catalog}
{current_task_list}
{environment}
{project_description}
{precursor_with_completed_outputs}
{previous_proposal_issues}
